<!DOCTYPE html>
<html lang="{{ lang }}" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Dodaj Przedmiot - Giełda Radom</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #121212; color: #e0e0e0; font-family: 'Inter', sans-serif; padding-bottom: 80px; }
        .navbar { background: rgba(0,0,0,0.9); border-bottom: 2px solid #f0c420; }
        .form-panel { background: #1a1a1a; border: 1px solid #333; border-radius: 20px; padding: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .form-control, .form-select { background-color: rgba(0,0,0,0.5); border: 1px solid #444; color: white; border-radius: 12px; padding: 12px; }
        .form-control:focus, .form-select:focus { border-color: #f0c420; box-shadow: 0 0 15px rgba(240, 196, 32, 0.3); }
        .btn-submit { background: #f0c420; color: #000; font-weight: 900; border-radius: 14px; padding: 15px; text-transform: uppercase; border: none; transition: 0.3s; }
        .btn-submit:hover { background: #d4a017; transform: translateY(-2px); }
        
        .cat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .cat-item input { display: none; }
        .cat-label { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 90px; background: rgba(0,0,0,0.5); border: 2px solid #333; border-radius: 16px; cursor: pointer; color: #888; transition: 0.2s; font-weight: bold; }
        .cat-label i { font-size: 2rem; margin-bottom: 5px; }
        
        #cat_rozm:checked + .cat-label { border-color: #f0c420; color: #f0c420; background: rgba(240, 196, 32, 0.1); box-shadow: 0 0 20px rgba(240, 196, 32, 0.3); }
        #cat_dom:checked + .cat-label { border-color: #28a745; color: #28a745; background: rgba(40, 167, 69, 0.1); box-shadow: 0 0 20px rgba(40, 167, 69, 0.3); }

        #loaderOverlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.9); z-index: 99999; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .spinner-border { width: 4rem; height: 4rem; color: #f0c420; }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark py-3 mb-4">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand fw-bold fs-4" href="/profil">
                <i class="bi bi-arrow-left me-2"></i> Wróć do Garażu
            </a>
        </div>
    </nav>

    <div class="container mb-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <h3 class="fw-bold text-white mb-4"><i class="bi bi-box-seam text-warning me-2"></i> Dodaj Przedmiot</h3>
                
                <div class="form-panel">
                    <form action="/dodaj_przedmiot" method="POST" enctype="multipart/form-data" onsubmit="document.getElementById('loaderOverlay').style.display='flex'; return true;">
                        
                        <div class="cat-grid">
                            <div class="cat-item">
                                <input type="radio" name="typ" id="cat_rozm" value="Rozmaitosci" checked onchange="updateSubcats()">
                                <label for="cat_rozm" class="cat-label"><i class="bi bi-gear-wide-connected"></i> Części i Akcesoria</label>
                            </div>
                            <div class="cat-item">
                                <input type="radio" name="typ" id="cat_dom" value="DomOgrad" onchange="updateSubcats()">
                                <label for="cat_dom" class="cat-label"><i class="bi bi-house-door"></i> Dom i Ogród</label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="fw-bold text-muted mb-2">ZDJĘCIA (Max 18)</label>
                            <input type="file" name="zdjecia" multiple accept="image/*" id="galleryInput" class="d-none" required>
                            <label for="galleryInput" class="form-control text-center d-flex flex-column justify-content-center align-items-center" style="cursor: pointer; border: 2px dashed #666; min-height: 100px;">
                                <i class="bi bi-camera fs-2 text-warning mb-2"></i>
                                <span id="fileCount" class="text-white fw-bold">Kliknij, aby dodać zdjęcia</span>
                            </label>
                        </div>

                        <div class="row g-3">
                            <div class="col-12">
                                <label class="small fw-bold text-muted mb-1">Dokładna Podkategoria</label>
                                <select name="podkategoria" id="select_podkategoria" class="form-select fw-bold text-warning border-warning bg-dark" required>
                                    </select>
                            </div>

                            <div class="col-md-6">
                                <label class="small fw-bold text-muted mb-1">Nazwa / Model</label>
                                <input type="text" name="nazwa" class="form-control" placeholder="np. Komplet Felg 17 / Kosiarka" required>
                            </div>
                            <div class="col-md-6">
                                <label class="small fw-bold text-muted mb-1">Producent (Opcjonalnie)</label>
                                <input type="text" name="producent" class="form-control" placeholder="np. BBS / Makita">
                            </div>

                            <div class="col-md-6">
                                <label class="small fw-bold text-muted mb-1">Cena</label>
                                <div class="input-group">
                                    <input type="number" name="cena" class="form-control fw-bold text-white border-danger" required>
                                    <select name="waluta" class="form-select border-danger" style="max-width: 90px;">
                                        <option value="PLN">PLN</option>
                                        <option value="EUR">EUR</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <label class="small fw-bold text-muted mb-1">Stan Przedmiotu</label>
                                <select name="stan" class="form-select fw-bold text-success border-success bg-dark">
                                    <option value="Nowy">✨ Fabrycznie Nowy</option>
                                    <option value="Używany" selected>Używany (Dobry stan)</option>
                                    <option value="Uszkodzony">Uszkodzony / Na części</option>
                                </select>
                            </div>

                            <div class="col-12">
                                <label class="small fw-bold text-warning mb-1">Kod EAN / Numer Seryjny (Wymagany wg prawa)</label>
                                <input type="text" name="ean" class="form-control text-uppercase border-warning" placeholder="Wpisz kod kreskowy...">
                            </div>

                            <div class="col-12">
                                <label class="small fw-bold text-muted mb-1">Opis (Zastosowanie, wymiary, wady itp.)</label>
                                <textarea name="opis" class="form-control" rows="5" placeholder="Dokładnie opisz sprzedawany przedmiot..." required></textarea>
                            </div>

                            <div class="col-12">
                                <label class="small fw-bold text-muted mb-1">Telefon Kontaktowy</label>
                                <input type="text" name="telefon" class="form-control" required>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-submit w-100 mt-4 shadow-lg"><i class="bi bi-check2-circle me-2"></i> WYSTAW PRZEDMIOT</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="loaderOverlay">
        <div class="spinner-border" role="status"></div>
        <h4 class="text-warning mt-3 fw-bold">DODAWANIE OGŁOSZENIA...</h4>
    </div>

    <script>
        // Logika wyświetlania nazwy wgranych plików (zdjęć)
        document.getElementById('galleryInput').addEventListener('change', function() {
            const count = this.files.length;
            const label = document.getElementById('fileCount');
            if(count > 0) {
                label.innerHTML = `<span class="text-success"><i class="bi bi-check-circle-fill"></i> Załadowano ${count} zdjęć</span>`;
                label.parentElement.style.borderColor = '#28a745';
            } else {
                label.innerHTML = 'Kliknij, aby dodać zdjęcia';
                label.parentElement.style.borderColor = '#666';
            }
        });

        // Magia zmiany list rozwijanych na podstawie wybranego dużego kafla
        function updateSubcats() {
            const isParts = document.getElementById('cat_rozm').checked;
            const select = document.getElementById('select_podkategoria');
            
            if(isParts) {
                select.className = "form-select fw-bold text-warning border-warning bg-dark";
                select.innerHTML = `
                    <option value="Opony i Felgi">Opony i Felgi</option>
                    <option value="Części Karoserii">Części Karoserii (Blacharka)</option>
                    <option value="Silnik i Osprzęt">Silnik i Osprzęt</option>
                    <option value="Oświetlenie">Oświetlenie (Lampy)</option>
                    <option value="Wnętrze i Audio">Wnętrze i Audio</option>
                    <option value="Narzędzia Warsztatowe">Narzędzia Warsztatowe</option>
                    <option value="Oleje i Chemia">Oleje i Chemia</option>
                    <option value="Akcesoria">Inne Akcesoria Motoryzacyjne</option>
                `;
            } else {
                select.className = "form-select fw-bold text-success border-success bg-dark";
                select.innerHTML = `
                    <option value="Narzędzia Ogrodowe">Narzędzia Ogrodowe (Kosiarki itp.)</option>
                    <option value="Meble Domowe">Meble Domowe</option>
                    <option value="Wyposażenie Ogrodu">Meble i Wyposażenie Ogrodu</option>
                    <option value="Materiały Budowlane">Materiały Budowlane</option>
                    <option value="Elektronarzędzia">Elektronarzędzia (Wiertarki itp.)</option>
                    <option value="Rośliny i Nasiona">Rośliny i Nasiona</option>
                    <option value="Dekoracje i Inne">Dekoracje i Inne</option>
                `;
            }
        }
        
        // Uruchom od razu, żeby na start pokazało listę części
        updateSubcats();
    </script>
</body>
</html>
