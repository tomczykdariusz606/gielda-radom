<!DOCTYPE html>
<html lang="{{ lang }}" data-bs-theme="dark">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17939880807"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-17939880807');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    
    <title>{{ t.get('garage', 'Twój Garaż') }} - Giełda Radom</title>
    <meta name="description" content="Giełda Radom - Najnowocześniejszy marketplace samochodowy w regionie. Sprzedaj swoje auto z pomocą sztucznej inteligencji Gemini.">
    <meta name="keywords" content="giełda radom, samochody radom, sprzedaż auta, komis radom, auto giełda, gemini ai car">
    <meta name="author" content="Giełda Radom">
    <meta name="robots" content="noindex, nofollow">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gieldaradom.pl/profil">
    <meta property="og:title" content="{{ t.get('garage', 'Twój Garaż') }} - Giełda Radom">
    <meta property="og:description" content="Zarządzaj swoimi ogłoszeniami i sprzedawaj szybciej na Giełdzie Radom.">
    <meta property="og:image" content="{{ url_for('static', filename='watermark.png') }}">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --radom-red: #ce2b37; --premium-gold: #f0c420; }
        
        body { 
            color: #e4e6eb; font-family: 'Inter', sans-serif; padding-bottom: 0px; 
            background-color: #050505;
            background-image: url("{{ url_for('static', filename='czerwiec_tlo1.jpg') }}");
            background-size: cover; background-position: center; background-attachment: fixed;
            position: relative; min-height: 100vh;
        }
        
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.50); z-index: -1;
        }
        
        .navbar { 
            background: rgba(15, 15, 15, 0.85); 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-bottom: 2px solid var(--radom-red); 
        }

        .hero-section {
            background: rgba(25, 25, 30, 0.6);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            position: relative; overflow: hidden;
            padding: 2rem 1rem 3rem 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            border-radius: 0 0 30px 30px;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
        }
        .hero-bg { display: none; } 
        .hero-content { position: relative; z-index: 1; }
        
        .profile-avatar {
            width: 90px; height: 90px; border-radius: 50%;
            border: 3px solid var(--radom-red);
            box-shadow: 0 0 20px rgba(206, 43, 55, 0.5);
            object-fit: cover; background: #000;
        }

        .glass-stat {
            background: rgba(20, 20, 25, 0.7);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px; padding: 15px;
            height: 100%; transition: 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        }
        .limit-bar-bg { background: rgba(255,255,255,0.1); height: 6px; border-radius: 10px; overflow: hidden; margin-top: 8px; }
        .limit-bar-fill { background: var(--radom-red); height: 100%; transition: width 0.5s; }

        .text-gold-glow { color: var(--premium-gold) !important; text-shadow: 0 0 15px rgba(240, 196, 32, 0.6); letter-spacing: 1px; }
        .btn-gold-premium {
            background: linear-gradient(135deg, #f0c420, #d4a017) !important;
            color: #000 !important; border: none !important; font-weight: 900 !important;
            box-shadow: 0 4px 15px rgba(240, 196, 32, 0.5) !important;
            transition: all 0.3s ease !important; position: relative; overflow: hidden;
        }

        .car-card { 
            background: rgba(25, 25, 30, 0.75); 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15); 
            border-radius: 16px; overflow: hidden; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.6); transition: transform 0.2s, border-color 0.2s; 
        }
        .car-card:hover { transform: translateY(-5px); border-color: var(--radom-red); box-shadow: 0 15px 35px rgba(206,43,55,0.4); }
        
        .form-control, .form-select { 
            background-color: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255,255,255,0.2); 
            color: white; padding: 10px; border-radius: 8px;
        }
        .form-control:focus { background-color: rgba(0,0,0,0.8); border-color: var(--radom-red); color: white; box-shadow: 0 0 10px rgba(206,43,55,0.4); }
        
        .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .cat-item input { display: none; }
        .cat-label { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 70px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px; cursor: pointer; font-size: 0.75rem; text-align: center; color: #b0b3b8; transition: 0.2s; }
        .cat-item input:checked + .cat-label { background: rgba(206,43,55,0.25); border-color: var(--radom-red); color: white; font-weight: bold; box-shadow: 0 0 15px rgba(206, 43, 55, 0.5); }
        
        .custom-dropdown-btn {
            background-color: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255,255,255,0.2); color: white;
            width: 100%; padding: 10px; text-align: left; border-radius: 6px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .custom-dropdown-btn:hover, .custom-dropdown-btn[aria-expanded="true"] { background-color: rgba(0,0,0,0.8); border-color: var(--radom-red); color: white; }
        .dropdown-menu-dark { background-color: #1a1a1a; border: 1px solid #333; box-shadow: 0 10px 40px rgba(0,0,0,0.9); }
        .dropdown-item { color: #ccc; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .dropdown-item:hover { background-color: var(--radom-red); color: white; }

        .scanner-box { border: 2px dashed var(--premium-gold); border-radius: 15px; padding: 20px; text-align: center; background: rgba(0,0,0,0.5); margin-bottom: 20px; backdrop-filter: blur(5px); }
        .btn-submit-fix { background: linear-gradient(135deg, var(--radom-red), #911620); color: white; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; padding: 15px; width: 100%; border-radius: 12px; border: none; box-shadow: 0 8px 25px rgba(206, 43, 55, 0.5); margin-top: 20px; transition: 0.3s; }
        .btn-submit-fix:hover { transform: translateY(-2px); box-shadow: 0 12px 30px rgba(206, 43, 55, 0.7); }
        
        #aiToast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
            background: rgba(240, 196, 32, 0.95); color: black; padding: 15px 25px; border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8); z-index: 9999; font-weight: bold; display: none;
            text-align: center; width: 90%; max-width: 400px; animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp { from { bottom: -100px; } to { bottom: 100px; } }
        
        #loaderOverlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.85); z-index: 99999; display: none;
            flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(15px);
        }
        .loading-text { font-family: 'Inter', sans-serif; font-size: 1.2rem; font-weight: 700; color: white; letter-spacing: 3px; text-transform: uppercase; animation: pulseText 1.5s infinite ease-in-out; margin-top: 10px; }
        #loaderVideo { width: 150px; height: auto; border-radius: 50%; box-shadow: 0 0 50px rgba(206,43,55, 0.5); margin-bottom: 20px; }
        @keyframes pulseText { 0% { opacity: 0.4; transform: scale(0.98); } 50% { opacity: 1; transform: scale(1.02); color: var(--radom-red); } 100% { opacity: 0.4; transform: scale(0.98); } }

        .nav-bottom { 
            position: fixed; bottom: 0; width: 100%; background: rgba(10,10,10,0.90); 
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); 
            z-index: 1000; display: flex; justify-content: space-around; padding: 12px 0; 
            box-shadow: 0 -10px 30px rgba(0,0,0,0.8); border-top: 1px solid rgba(255,255,255,0.05); 
        }
        .nav-item { text-align: center; color: #777; text-decoration: none; font-size: 0.75rem; transition: 0.3s; flex: 1; }
        .nav-item.active { color: var(--radom-red); font-weight: 700; text-shadow: 0 0 10px rgba(206,43,55,0.6); }
        .nav-item i { font-size: 1.4rem; display: block; margin-bottom: 2px; }

        .modal-content {
            background: rgba(25, 25, 30, 0.85) !important;
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.15) !important;
            border-top: 2px solid var(--radom-red) !important;
            color: #eee !important;
            box-shadow: 0 25px 50px rgba(0,0,0,0.8) !important;
        }

                /* STOPKA */
        .seo-footer {
            background: rgba(10,10,10,0.95);
            padding: 40px 0 110px 0; /* padding bottom dla nav-bottom */
            border-top: 1px solid rgba(255,255,255,0.05);
            color: #777;
            font-size: 0.85rem;
            margin-top: 50px;
        }
        .footer-link { color: #b0b3b8; text-decoration: none; transition: 0.2s; }
        .footer-link:hover { color: var(--radom-red); }

    </style>
</head>
<body class="pb-0">

    <nav class="navbar navbar-dark p-3 mb-0">
        <div class="container d-flex justify-content-between align-items-center">
            <a class="navbar-brand fw-bold fs-4 d-flex align-items-center" href="/">
                <img src="{{ url_for('static', filename='watermark.png') }}" alt="G" style="height: 45px; width: auto; margin-right: 10px; filter: drop-shadow(0 0 5px rgba(255,255,255,0.2));">
                <span style="font-family: 'Inter', sans-serif; letter-spacing: 1px;">GIEŁDA <span class="text-danger">RADOM</span></span>
            </a>
            <a href="/logout" class="btn btn-sm btn-outline-danger rounded-pill px-3">{{ t.get('logout', 'Wyloguj') }}</a>
        </div>
    </nav>

    <div class="hero-section">
        <div class="hero-bg"></div>
        <div class="hero-content container">
            <div class="row align-items-center">
                <div class="col-auto">
                    <img src="{{ current_user.avatar_url or url_for('static', filename='watermark.png') }}" class="profile-avatar" alt="User">
                </div>
                <div class="col">
                    <h5 class="text-white-50 m-0 small text-uppercase mb-1">
                        {% if current_user.account_type == 'company' %}
                            <i class="bi bi-shop text-warning"></i> {{ t.get('company', 'Firma') }}: {{ current_user.company_name }}
                        {% else %}
                            <i class="bi bi-person text-info"></i> {{ t.get('private_person', 'Osoba Prywatna') }}
                        {% endif %}
                    </h5>
                    <h2 class="fw-bold text-white m-0 text-truncate">{{ current_user.username }}</h2>
                    
                    <div class="mt-2 d-flex flex-wrap gap-2">
                        <button class="btn btn-sm btn-outline-secondary rounded-pill fw-bold" data-bs-toggle="modal" data-bs-target="#ustawieniaModal">
                            <i class="bi bi-gear-fill me-1"></i> EDYTUJ PROFIL
                        </button>
                        
                        <form id="avatarForm" action="/zmien_avatar" method="POST" enctype="multipart/form-data" class="m-0">
                            <label class="btn btn-sm btn-outline-info rounded-pill fw-bold mb-0" style="cursor: pointer;">
                                <i class="bi bi-camera-fill me-1"></i> EDYTUJ MINIATURKĘ
                                <input type="file" name="avatar" accept="image/*" style="display: none;" onchange="document.getElementById('loaderOverlay').style.display='flex'; this.form.submit();">
                            </label>
                        </form>
                    </div>
                </div>
            </div>

            <div class="row g-2 mt-4">
                <div class="col-6">
                    <div class="glass-stat">
                        {% if current_user.username == 'admin' or current_user.id == 1 %}
                            {% set limit = 500 %}{% else %}{% set limit = 6 %}{% endif %}
                        {% set uzyte = current_user.ai_requests_today %}
                        {% set pozostalo = limit - uzyte %}{% if pozostalo < 0 %}{% set pozostalo = 0 %}{% endif %}
                        <div class="d-flex justify-content-between text-white-50 small mb-1"><span>{{ t.get('limit', 'Limit AI') }}</span> <i class="bi bi-robot"></i></div>
                        <h4 class="fw-bold m-0 text-white">{{ pozostalo }}<span class="fs-6 text-muted">/{{ limit }}</span></h4>
                        <div class="limit-bar-bg"><div class="limit-bar-fill" style="width: {{ (uzyte / limit) * 100 }}%"></div></div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="glass-stat">
                        <div class="d-flex justify-content-between text-white-50 small mb-1"><span>Aktywne</span> <i class="bi bi-car-front"></i></div>
                        <h4 class="fw-bold m-0 text-white">{% if pagination %}{{ pagination.total }}{% else %}{{ cars|length }}{% endif %} <span class="fs-6 text-muted">ofert</span></h4>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container" style="margin-top: -30px; position: relative; z-index: 10;">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show shadow-lg border-0 rounded-4" role="alert">
                        <i class="bi bi-info-circle-fill me-2"></i> {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <button class="btn btn-danger w-100 rounded-4 py-3 shadow-lg fw-bold mb-4 fs-5 d-flex align-items-center justify-content-center gap-2" data-bs-toggle="modal" data-bs-target="#dodajModal">
            <i class="bi bi-plus-circle-fill"></i> {{ t.get('add', 'DODAJ OGŁOSZENIE') }}
        </button>

        <h5 class="fw-bold text-white mb-3 ps-2 border-start border-4 border-danger ps-3">{{ t.get('your_ads', 'TWOJE OGŁOSZENIA') }}</h5>
        
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">
            {% for car in cars %}
            <div class="col">
                <div class="card car-card h-100">
                    <div class="position-relative">
                        <img src="{{ car.img }}" class="card-img-top" style="height: 190px; object-fit: cover; opacity: 0.9;">
                        {% set dni = (now - car.data_dodania).days %}{% set left = 30 - dni %}
                        <span class="position-absolute top-0 end-0 m-2 badge {% if left < 3 %}bg-danger{% else %}bg-black{% endif %} bg-opacity-75 rounded-pill border border-secondary">{% if left > 0 %}{{ left }} {{ t.get('days_left', 'dni') }}{% else %}{{ t.get('expired', 'WYGASŁO') }}{% endif %}</span>
                        {% if car.is_promoted %}<span class="position-absolute top-0 start-0 m-2 badge bg-warning text-dark border border-white shadow fw-bold">GOLD</span>{% endif %}
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h5 class="fw-bold text-truncate text-white mb-1">{{ car.marka }} {{ car.model }}</h5>
                        <h4 class="text-danger fw-800">{{ "{:,.0f}".format(car.cena).replace(',', ' ') }} {{ car.waluta if car.waluta else 'PLN' }}</h4>
                        <div class="row g-2 small text-muted mb-3 mt-1">
                            <div class="col-6"><i class="bi bi-calendar3"></i> {{ car.rok }}</div>
                            <div class="col-6"><i class="bi bi-fuel-pump"></i> {{ car.paliwo }}</div>
                            <div class="col-6"><i class="bi bi-speedometer2"></i> {{ car.przebieg }}</div>
                            <div class="col-6"><i class="bi bi-eye"></i> {{ car.views }}</div>
                        </div>
                                                <div class="mt-auto pt-3 border-top border-secondary border-opacity-50">
                            
                            <div class="row g-2 mb-2">
                                <div class="col-4">
                                    <a href="/ogloszenie/{{ car.id }}" class="btn btn-outline-info btn-sm w-100 fw-bold py-2" title="Podgląd ogłoszenia">
                                        <i class="bi bi-eye fs-6"></i>
                                    </a>
                                </div>
                                <div class="col-4">
                                    <a href="/edytuj/{{ car.id }}" class="btn btn-outline-light btn-sm w-100 fw-bold py-2" title="Edytuj ogłoszenie">
                                        <i class="bi bi-pencil-square fs-6"></i>
                                    </a>
                                </div>
                                                                <div class="col-4">
                                    {% set roznica_godzin = (now - car.data_dodania).total_seconds() / 3600 %}
                                    {% set pozostalo_godzin = (72 - roznica_godzin)|int %}
                                    {% if pozostalo_godzin < 0 %}{% set pozostalo_godzin = 0 %}{% endif %}
                                    {% set mozna_podbic = (roznica_godzin >= 72) or (current_user.username == 'admin' or current_user.id == 1) %}
                                    
                                    <form action="/odswiez/{{ car.id }}" method="POST">
                                        <button type="submit" class="btn {% if mozna_podbic %}btn-success{% else %}btn-secondary bg-opacity-50{% endif %} btn-sm w-100 fw-bold text-white shadow-sm d-flex align-items-center justify-content-center" style="height: 38px;" {% if not mozna_podbic %}disabled{% endif %}>
                                            {% if mozna_podbic %}
                                                <i class="bi bi-arrow-up-circle-fill fs-6"></i>
                                            {% else %}
                                                <i class="bi bi-clock-history me-1"></i> <span style="font-size: 0.75rem;">{{ pozostalo_godzin }}h</span>
                                            {% endif %}
                                        </button>
                                    </form>
                                </div>

                            </div>

                            <div class="row g-2 mb-2">
                                <div class="col-8">
                                    <form action="/rezerwacja/{{ car.id }}" method="POST">
                                        <button type="submit" class="btn btn-sm w-100 fw-bold py-2 shadow-sm {% if car.is_reserved %}btn-success{% else %}btn-outline-warning{% endif %}" style="letter-spacing: 1px;">
                                            {% if car.is_reserved %}
                                                <i class="bi bi-unlock-fill me-1"></i> ODBLOKUJ
                                            {% else %}
                                                <i class="bi bi-lock-fill me-1"></i> ZAREZERWUJ
                                            {% endif %}
                                        </button>
                                    </form>
                                </div>
                                <div class="col-4">
                                    <form action="/usun/{{ car.id }}" method="POST" onsubmit="return confirm('Czy na pewno chcesz bezpowrotnie usunąć to ogłoszenie ze zdjęciami?');">
                                        <button type="submit" class="btn btn-outline-danger btn-sm w-100 fw-bold py-2" title="Usuń trwale">
                                            <i class="bi bi-trash3-fill fs-6"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>

                                                       {% if current_user.username == 'admin' or current_user.id == 1 %}
                            <div class="row g-2">
                                <div class="col-12">
                                    <a href="/generate_360/{{ car.id }}" class="btn btn-sm w-100 fw-bold py-2 shadow-sm text-dark" style="background: linear-gradient(135deg, #f0c420, #d4a017); border: none; letter-spacing: 0.5px;">
                                        <i class="bi bi-view-360 me-1"></i> GENERUJ 360° PREMIUM
                                    </a>
                                </div>
                            </div>
                            {% endif %}

                        </div> </div> </div> </div> {% else %}
            <div class="col-12 text-center text-muted py-5 border border-secondary rounded-4 bg-dark bg-opacity-25">
                <i class="bi bi-car-front fs-1 mb-3 d-block opacity-25"></i>
                <h5 class="text-white opacity-50">{{ t.get('empty_garage', 'Garaż jest pusty') }}</h5>
            </div>
            {% endfor %}
        </div> {% if pagination and pagination.pages > 1 %}
        <nav aria-label="Nawigacja stron" class="mt-4 mb-5">
            <ul class="pagination justify-content-center mb-0 shadow-sm">
                <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
                    <a class="page-link bg-dark text-white border-secondary" href="?page={{ pagination.prev_num if pagination.has_prev else 1 }}">&laquo; Poprzednia</a>
                </li>

                {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                    {% if page_num %}
                        {% if pagination.page == page_num %}
                            <li class="page-item active"><span class="page-link bg-danger border-danger text-white fw-bold">{{ page_num }}</span></li>
                        {% else %}
                            <li class="page-item"><a class="page-link bg-dark text-white border-secondary" href="?page={{ page_num }}">{{ page_num }}</a></li>
                        {% endif %}
                    {% else %}
                        <li class="page-item disabled"><span class="page-link bg-dark text-white border-secondary">...</span></li>
                    {% endif %}
                {% endfor %}

                <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
                    <a class="page-link bg-dark text-white border-secondary" href="?page={{ pagination.next_num if pagination.has_next else pagination.pages }}">Następna &raquo;</a>
                </li>
            </ul>
        </nav>
        {% endif %}
        <h5 class="fw-bold text-white mb-3 mt-5 ps-2 border-start border-4 border-warning ps-3">{{ t.get('observed', 'OBSERWOWANE OFERTY') }}</h5>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">
            {% for fav in favorites %}
            {% set f_car = fav.car %}
            <div class="col">
                <div class="card car-card h-100 border-warning border-opacity-25">
                    <div class="position-relative">
                        <img src="{{ f_car.img }}" class="card-img-top" style="height: 160px; object-fit: cover; opacity: 0.8;">
                        <a href="/toggle_favorite/{{ f_car.id }}" class="position-absolute top-0 end-0 m-2 badge bg-danger rounded-circle p-2" style="cursor:pointer;"><i class="bi bi-heart-fill"></i></a>
                    </div>
                    <div class="card-body">
                        <h6 class="fw-bold text-truncate text-white mb-1">{{ f_car.marka }} {{ f_car.model }}</h6>
                        <div class="d-flex justify-content-between align-items-center"><span class="text-warning fw-bold">{{ "{:,.0f}".format(f_car.cena).replace(',', ' ') }} {{ f_car.waluta if f_car.waluta else 'PLN' }}</span><a href="/ogloszenie/{{ f_car.id }}" class="btn btn-sm btn-outline-warning py-0 px-2" style="font-size: 0.7rem;">{{ t.get('see_details', 'ZOBACZ') }}</a></div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12 text-center text-muted py-4 border border-secondary border-dashed rounded-4 bg-dark bg-opacity-10"><p class="small mb-0 opacity-25">{{ t.get('no_favorites', 'Nie obserwujesz jeszcze żadnych ogłoszeń.') }}</p></div>
            {% endfor %}
        </div>

        {% if current_user.username == 'admin' or current_user.id == 1 %}
        <div class="card admin-box shadow-lg mb-5 border-0" style="background: linear-gradient(145deg, #1a1a1a, #000); border-left: 5px solid #ffc107;">
            <div class="card-header bg-transparent border-warning d-flex justify-content-between align-items-center pt-3 pb-2">
                <h5 class="text-warning mb-0 fw-bold" style="letter-spacing: 1px;"><i class="bi bi-shield-lock-fill me-2"></i> CENTRUM DOWODZENIA</h5>
                <span class="badge bg-warning text-dark shadow fw-bold">ROOT</span>
            </div>
            <div class="card-body text-white">
                <div class="row g-3 mb-4 text-center">
                    <div class="col-4"><div class="p-3 rounded-3 border border-secondary bg-dark bg-opacity-50"><h3 class="fw-bold text-white mb-0">{{ user_count }}</h3><small class="text-secondary fw-bold" style="font-size:0.6rem;">KONTA</small></div></div>
                    <div class="col-4"><div class="p-3 rounded-3 border border-success bg-success bg-opacity-10"><h3 class="fw-bold text-success mb-0">{{ online_count }}</h3><small class="text-success fw-bold" style="font-size:0.6rem;">ONLINE</small></div></div>
                    <div class="col-4"><div class="p-3 rounded-3 border border-info bg-info bg-opacity-10"><h3 class="fw-bold text-info mb-0">{{ total_views }}</h3><small class="text-info fw-bold" style="font-size:0.6rem;">WIDOKI</small></div></div>
                </div>
                             <div class="bg-black bg-opacity-25 p-3 rounded-3 border border-secondary">
                    <button class="btn btn-danger w-100 fw-bold shadow-sm mb-3" data-bs-toggle="modal" data-bs-target="#usersModal"><i class="bi bi-people-fill me-2"></i> ZARZĄDZAJ USERAMI</button>
<form action="/admin/wyslij_powitania" method="POST" class="mb-3" onsubmit="return confirm('Czy na pewno chcesz wysłać e-mail powitalny do WSZYSTKICH użytkowników w bazie?');">
    <button type="submit" class="btn btn-info w-100 fw-bold shadow-sm text-dark" style="letter-spacing: 0.5px;">
        <i class="bi bi-envelope-paper-fill me-2"></i> WYŚLIJ MAILE POWITALNE
    </button>
</form>

                    <div class="d-flex gap-2"><a href="{{ url_for('backup_db') }}" class="btn btn-outline-warning w-100 fw-bold btn-sm py-2"><i class="bi bi-database"></i> SQL</a><a href="{{ url_for('full_backup') }}" class="btn btn-warning w-100 fw-bold btn-sm py-2 text-dark"><i class="bi bi-archive-fill"></i> ZIP</a></div>

                    </div>
                </div>

        </div>
        {% endif %}
        
        <div class="text-center mt-5 mb-5 opacity-50">
            <form action="/usun_konto" method="POST" onsubmit="return confirm('Czy na pewno?');"><button class="btn btn-link text-danger text-decoration-none btn-sm">Usuń konto</button></form>
        </div>
    </div>

       <footer class="seo-footer">
        <div class="container">
            <div class="row g-4">
                <div class="col-12 col-md-4 text-center text-md-start">
                    <h5 class="text-white fw-bold mb-3">Giełda <span class="text-danger">Radom</span></h5>
                    <p class="small">Innowacyjna platforma sprzedaży pojazdów wykorzystująca najnowsze technologie AI. Twoje auto, nasza pasja.</p>
                </div>
                <div class="col-6 col-md-4 text-center">
                    <h6 class="text-white fw-bold mb-3">MENU</h6>
                    <ul class="list-unstyled">
                        <li><a href="/" class="footer-link">Strona Główna</a></li>
                        <li><a href="/kontakt" class="footer-link">Kontakt</a></li>
                        <li><a href="/regulamin" class="footer-link">Regulamin</a></li>
                        <li><a href="/polityka" class="footer-link">Polityka prywatności</a></li>
                    </ul>
                </div>
                <div class="col-6 col-md-4 text-center text-md-end">
                    <h6 class="text-white fw-bold mb-3">WSPARCIE</h6>
                    <a href="/sitemap.xml" style="display: none;">Sitemap</a>
                    
                    <p class="small mb-2 text-muted">Masz pytania?</p>
                    <a href="/kontakt" class="btn btn-outline-danger btn-sm rounded-pill fw-bold px-3">
                        <i class="bi bi-envelope-fill me-1"></i> Napisz do nas
                    </a>
                </div>
            </div>
            <hr class="border-secondary my-4">
            <div class="text-center small opacity-50">
                &copy; 2026 Giełda Radom. Wszelkie prawa zastrzeżone. Projekt i realizacja: ADT & AI Team.
            </div>
        </div>
    </footer>


    <div class="nav-bottom">
        <a href="/szukaj" class="nav-item"><i class="bi bi-search"></i> {{ t.get('search', 'Szukaj') }}</a>
        <a href="/profil" class="nav-item active"><i class="bi bi-speedometer2"></i> {{ t.get('garage', 'Garaż') }}</a>
        <a href="/kontakt" class="nav-item"><i class="bi bi-envelope"></i> {{ t.get('contact', 'Kontakt') }}</a>
    </div>

    <div class="modal fade" id="dodajModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content shadow-lg rounded-4 border border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="fw-bold text-white">{{ t.get('add', 'DODAJ OGŁOSZENIE') }}</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form action="/dodaj" method="POST" enctype="multipart/form-data" onsubmit="loadingEfekt(this); return true;">
                    <input type="hidden" name="lat" id="gps_lat">
                    <input type="hidden" name="lon" id="gps_lon">

                    <div class="modal-body p-4 pt-2">
                        <div class="cat-grid">
                            <div class="cat-item"><input type="radio" name="typ" id="c1" value="Osobowe" checked onchange="adj()"><label for="c1" class="cat-label"><i class="bi bi-car-front"></i>{{ t.get('car_passenger', 'Osobowe') }}</label></div>
                            <div class="cat-item"><input type="radio" name="typ" id="c2" value="SUV" onchange="adj()"><label for="c2" class="cat-label"><i class="bi bi-truck-front"></i>{{ t.get('car_suv', 'SUV') }}</label></div>
                            <div class="cat-item"><input type="radio" name="typ" id="c3" value="Minivan" onchange="adj()"><label for="c3" class="cat-label"><i class="bi bi-people-fill"></i>{{ t.get('car_minivan', 'Minivan') }}</label></div>
                            <div class="cat-item"><input type="radio" name="typ" id="c4" value="Ciezarowe" onchange="adj()"><label for="c4" class="cat-label"><i class="bi bi-truck"></i>{{ t.get('car_bus', 'Bus') }}</label></div>
                            <div class="cat-item"><input type="radio" name="typ" id="c5" value="Moto/Rower" onchange="adj()"><label for="c5" class="cat-label"><i class="bi bi-bicycle"></i>{{ t.get('car_moto', 'Moto') }}</label></div>
                            <div class="cat-item"><input type="radio" name="typ" id="c6" value="Inne" onchange="adj()"><label for="c6" class="cat-label"><i class="bi bi-grid"></i>{{ t.get('car_other', 'Inne') }}</label></div>
                        </div>

                        <div class="scanner-box">
                            <div class="mb-3 text-gold-glow fw-bold fs-5"><i class="bi bi-stars"></i> GEMINI 3.0 EXPERT <i class="bi bi-stars"></i></div>
                            <div class="d-flex justify-content-center gap-3">
                                <label class="btn btn-gold-premium rounded-pill px-4 py-2 shadow-lg"><i class="bi bi-camera-fill me-2 fs-5"></i> {{ t.get('scan_cam', 'SKANUJ (APARAT)') }}<input type="file" name="scan_image_cam" accept="image/*" capture="environment" hidden onchange="scanCar(this)"></label>
                                <label class="btn btn-outline-light rounded-pill px-3 py-2 fw-bold"><i class="bi bi-folder-fill me-2"></i> {{ t.get('scan_file', 'WGRAJ (PLIK)') }}<input type="file" name="scan_image_file" accept="image/*" hidden onchange="scanCar(this)"></label>
                            </div>
                            <div id="scanLoader" class="mt-3 small text-warning fw-bold" style="display:none;"><span class="spinner-border spinner-border-sm me-1"></span> Analiza AI...</div>
                        </div>
                        
                                                                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <label class="small fw-bold text-muted mb-0" id="photoLabel">{{ t.get('photos', 'ZDJĘCIA') }}</label>
                                <span class="small text-warning fw-bold">{{ t.get('max', 'MAX') }} 18</span>
                            </div>
                            
                            <input type="file" name="zdjecia" multiple accept="image/*" id="mainGalleryInput" class="d-none">
                            
                            <label for="mainGalleryInput" class="form-control text-center d-flex flex-column justify-content-center align-items-center" style="cursor: pointer; background-color: rgba(0,0,0,0.5); border: 2px dashed rgba(255,255,255,0.2); min-height: 90px; transition: 0.3s;" onmouseover="this.style.borderColor='var(--radom-red)'" onmouseout="this.style.borderColor='rgba(255,255,255,0.2)'">
                                <i class="bi bi-images fs-3 text-white-50 mb-1"></i>
                                <span id="fileCountText" class="text-white fw-bold" style="letter-spacing: 0.5px;">
                                    {{ t.get('select_multiple', 'Zaznacz kilka zdjęć na raz') }}
                                </span>
                            </label>
                        </div>



                        <div class="row g-2">
                            <div class="col-6"><label class="small fw-bold text-muted">{{ t.get('brand', 'Marka') }}</label><input type="text" name="marka" class="form-control" placeholder="np. BMW"></div>
                            <div class="col-6"><label class="small fw-bold text-muted">{{ t.get('model', 'Model') }}</label><input type="text" name="model" class="form-control" placeholder="np. X5"></div>
                            <div class="col-12"><label class="small fw-bold text-success">{{ t.get('vin', 'VIN') }}</label><input type="text" name="vin" class="form-control text-uppercase" placeholder="VIN..." maxlength="17"></div>
                            
                            <div class="col-6">
                                <label class="small fw-bold text-muted">{{ t.get('price_ad', 'Cena') }}</label>
                                <div class="input-group">
                                    <input type="number" name="cena" class="form-control border-danger text-danger fw-bold" style="border-right: none;" required>
                                    
                                    <input type="hidden" name="waluta" id="val_waluta" value="PLN">
                                    <button class="btn dropdown-toggle border-danger text-danger fw-bold px-2" type="button" data-bs-toggle="dropdown" id="btn_waluta" style="background-color: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); border-left: none; width: 80px;">
                                        PLN
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end shadow-lg" style="min-width: 80px;">
                                        <li><a class="dropdown-item fw-bold text-center" href="#" onclick="setVal('waluta', 'PLN', 'PLN'); return false;">PLN</a></li>
                                        <li><a class="dropdown-item fw-bold text-center" href="#" onclick="setVal('waluta', 'EUR', 'EUR'); return false;">EUR</a></li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="col-6 tech"><label class="small fw-bold text-muted">{{ t.get('mileage_ad', 'Przebieg') }}</label><input type="number" name="przebieg" class="form-control"></div>
                            
                            <div class="col-6 tech"><label class="small fw-bold text-warning">{{ t.get('power', 'Moc (KM)') }}</label><input type="number" name="moc" class="form-control border-warning text-warning fw-bold" placeholder="np. 150"></div>
                            <div class="col-6 tech"><label class="small fw-bold text-warning">{{ t.get('color', 'Kolor') }}</label><input type="text" name="kolor" class="form-control border-warning" placeholder="np. Czarny"></div>

                            <div class="col-6 tech"><label class="small fw-bold text-muted">{{ t.get('engine_cap', 'Pojemność') }}</label><input type="text" name="pojemnosc" class="form-control"></div>
                            
                            <div class="col-6 tech">
                                <label class="small fw-bold text-muted">{{ t.get('fuel', 'Paliwo') }}</label>
                                <input type="hidden" name="paliwo" id="val_paliwo" value="Benzyna">
                                <div class="dropdown">
                                    <button class="btn custom-dropdown-btn dropdown-toggle" type="button" data-bs-toggle="dropdown" id="btn_paliwo">
                                        {{ t.get('petrol', 'Benzyna') }}
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-dark w-100">
                                        <li><a class="dropdown-item" href="#" onclick="setVal('paliwo', 'Benzyna', `{{ t.get('petrol', 'Benzyna') }}`); return false;">{{ t.get('petrol', 'Benzyna') }}</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setVal('paliwo', 'Diesel', `{{ t.get('diesel', 'Diesel') }}`); return false;">{{ t.get('diesel', 'Diesel') }}</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setVal('paliwo', 'LPG', `{{ t.get('lpg', 'LPG') }}`); return false;">{{ t.get('lpg', 'LPG') }}</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setVal('paliwo', 'Hybryda', `{{ t.get('hybrid', 'Hybryda') }}`); return false;">{{ t.get('hybrid', 'Hybryda') }}</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setVal('paliwo', 'Elektryczny', `{{ t.get('electric', 'Elektryczny') }}`); return false;">{{ t.get('electric', 'Elektryczny') }}</a></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-6 tech">
                                <label class="small fw-bold text-muted">{{ t.get('gear', 'Skrzynia') }}</label>
                                <input type="hidden" name="skrzynia" id="val_skrzynia" value="Manualna">
                                <div class="dropdown">
                                    <button class="btn custom-dropdown-btn dropdown-toggle" type="button" data-bs-toggle="dropdown" id="btn_skrzynia">
                                        {{ t.get('man', 'Manualna') }}
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-dark w-100">
                                        <li><a class="dropdown-item" href="#" onclick="setVal('skrzynia', 'Manualna', `{{ t.get('man', 'Manualna') }}`); return false;">{{ t.get('man', 'Manualna') }}</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setVal('skrzynia', 'Automatyczna', `{{ t.get('auto', 'Automatyczna') }}`); return false;">{{ t.get('auto', 'Automatyczna') }}</a></li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="col-6"><label class="small fw-bold text-muted">{{ t.get('year_prod', 'Rok produkcji') }}</label><input type="number" name="rok" class="form-control"></div>

                            <div class="col-12"><label class="small fw-bold text-muted">{{ t.get('phone', 'Telefon') }}</label><input type="text" name="telefon" class="form-control" required></div>
                            <div class="col-12"><label class="small fw-bold text-muted">{{ t.get('desc', 'Opis') }}</label><textarea name="opis" class="form-control" rows="3" placeholder="..."></textarea></div>

                                                        <div class="col-12 mt-3">
                                <label class="small fw-bold text-muted mb-2">{{ t.get('equip', 'WYPOSAŻENIE (Zaznacz opcje)') }}</label>
                                
                                <div class="accordion accordion-flush" id="equipAccordion" style="border-radius: 10px; overflow: hidden; border: 1px solid rgba(255,255,255,0.15);">
                                    
                                    <div class="accordion-item bg-black bg-opacity-25 border-0 border-bottom border-secondary">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button bg-dark text-success fw-bold p-3 shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#colBasic" aria-expanded="true">
                                                <i class="bi bi-check2-square me-2"></i> {{ t.get('eq_cat_basic', 'PODSTAWOWE WYPOSAŻENIE') }}
                                            </button>
                                        </h2>
                                        <div id="colBasic" class="accordion-collapse collapse show" data-bs-parent="#equipAccordion">
                                            <div class="accordion-body row g-2 p-3">
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="ABS" id="w1"><label class="form-check-label small text-white" for="w1">{{ t.get('eq_abs', 'ABS') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="ESP" id="w2"><label class="form-check-label small text-white" for="w2">{{ t.get('eq_esp', 'ESP / ASR') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Poduszki powietrzne" id="w3"><label class="form-check-label small text-white" for="w3">{{ t.get('eq_airbags', 'Poduszki powietrzne') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="El. szyby" id="w11"><label class="form-check-label small text-white" for="w11">{{ t.get('eq_windows', 'El. szyby') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="El. lusterka" id="w12"><label class="form-check-label small text-white" for="w12">{{ t.get('eq_mirrors', 'El. lusterka') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Klimatyzacja" id="w7"><label class="form-check-label small text-white" for="w7">{{ t.get('eq_ac', 'Klimatyzacja manualna') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Isofix" id="w4"><label class="form-check-label small text-white" for="w4">{{ t.get('eq_isofix', 'Isofix') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Bluetooth / USB" id="w19"><label class="form-check-label small text-white" for="w19">{{ t.get('eq_bt', 'Bluetooth / USB') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Alufelgi" id="w24"><label class="form-check-label small text-white" for="w24">{{ t.get('eq_alloys', 'Alufelgi') }}</label></div></div>

<div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Światła LED" id="w_led_basic" {% if 'Światła LED' in current_options %}checked{% endif %}><label class="form-check-label small text-white" for="w_led_basic">{{ t.get('eq_led_basic', 'Światła LED') }}</label></div></div>
<div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Relingi dachowe" id="w_rails" {% if 'Relingi dachowe' in current_options %}checked{% endif %}><label class="form-check-label small text-white" for="w_rails">{{ t.get('eq_rails', 'Relingi dachowe') }}</label></div></div>

                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Hak" id="w26"><label class="form-check-label small text-white" for="w26">{{ t.get('eq_tow', 'Hak') }}</label></div></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="accordion-item bg-black bg-opacity-25 border-0 border-bottom border-secondary">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed bg-dark text-info fw-bold p-3 shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#colComfort" aria-expanded="false">
                                                <i class="bi bi-car-front-fill me-2"></i> {{ t.get('eq_cat_comfort', 'KOMFORT & DODATKI') }}
                                            </button>
                                        </h2>
                                        <div id="colComfort" class="accordion-collapse collapse" data-bs-parent="#equipAccordion">
                                            <div class="accordion-body row g-2 p-3">
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Klimatronik" id="w8"><label class="form-check-label small text-white" for="w8">{{ t.get('eq_climatronic', 'Klimatronik') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Czujniki parkowania" id="w23"><label class="form-check-label small text-white" for="w23">{{ t.get('eq_sensors', 'Czujniki parkowania') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Kamera cofania" id="w21"><label class="form-check-label small text-white" for="w21">{{ t.get('eq_cam_back', 'Kamera cofania') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Tempomat" id="w13"><label class="form-check-label small text-white" for="w13">{{ t.get('eq_cruise', 'Tempomat') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Podgrzewane fotele" id="w10"><label class="form-check-label small text-white" for="w10">{{ t.get('eq_heated_seats', 'Podgrzewane fotele') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Skórzana tapicerka" id="w9"><label class="form-check-label small text-white" for="w9">{{ t.get('eq_leather', 'Skórzana tapicerka') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Nawigacja" id="w18"><label class="form-check-label small text-white" for="w18">{{ t.get('eq_navi', 'Nawigacja') }}</label></div></div>
<div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Przyciemniane szyby" id="w_tinted" {% if 'Przyciemniane szyby' in current_options %}checked{% endif %}><label class="form-check-label small text-white" for="w_tinted">{{ t.get('eq_tinted', 'Przyciemniane szyby') }}</label></div></div>

                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Szyberdach" id="w16"><label class="form-check-label small text-white" for="w16">{{ t.get('eq_sunroof', 'Szyberdach') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Elektryczna klapa bagażnika" id="w_trunk"><label class="form-check-label small text-white" for="w_trunk">{{ t.get('eq_trunk', 'Elektryczna klapa') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Podgrzewana przednia szyba" id="w_wind"><label class="form-check-label small text-white" for="w_wind">{{ t.get('eq_heated_wind', 'Podgrzewana przednia szyba') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Lusterka fotochromatyczne" id="w_photo"><label class="form-check-label small text-white" for="w_photo">{{ t.get('eq_photochrom', 'Lusterka fotochromatyczne') }}</label></div></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="accordion-item bg-black bg-opacity-25 border-0">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed bg-dark text-warning fw-bold p-3 shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#colPremium" aria-expanded="false">
                                                <i class="bi bi-star-fill me-2"></i> {{ t.get('eq_cat_premium', 'PREMIUM & NOWE TECHNOLOGIE') }}
                                            </button>
                                        </h2>
                                        <div id="colPremium" class="accordion-collapse collapse" data-bs-parent="#equipAccordion">
                                            <div class="accordion-body row g-2 p-3">
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Klimatronik 4-strefowy" id="w_4zone"><label class="form-check-label small text-white" for="w_4zone">{{ t.get('eq_4zone', 'Klimatronik 4-strefowy') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Wentylowane fotele" id="w_vent"><label class="form-check-label small text-white" for="w_vent">{{ t.get('eq_vent_seats', 'Wentylowane fotele') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Fotele z masażem" id="w_massage"><label class="form-check-label small text-white" for="w_massage">{{ t.get('eq_massage', 'Fotele z masażem') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Podgrzewana kierownica" id="w_steer"><label class="form-check-label small text-white" for="w_steer">{{ t.get('eq_heated_steer', 'Podgrzewana kierownica') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Zawieszenie pneumatyczne" id="w_susp"><label class="form-check-label small text-white" for="w_susp">{{ t.get('eq_air_susp', 'Zawieszenie pneumatyczne') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Dociąganie drzwi" id="w_soft"><label class="form-check-label small text-white" for="w_soft">{{ t.get('eq_soft_close', 'Dociąganie drzwi') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Reflektory Matrix / Laser" id="wp7" {% if 'Reflektory Matrix / Laser' in current_options %}checked{% endif %}><label class="form-check-label small text-white" for="wp7">{{ t.get('eq_matrix', 'Reflektory Matrix / Laser') }}</label></div></div>

                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Dach panoramiczny" id="w_pano"><label class="form-check-label small text-white" for="w_pano">{{ t.get('eq_pano', 'Dach panoramiczny') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Oświetlenie Ambient" id="w_ambient"><label class="form-check-label small text-white" for="w_ambient">{{ t.get('eq_ambient', 'Oświetlenie Ambient') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Kamera 360" id="w22"><label class="form-check-label small text-white" for="w22">{{ t.get('eq_cam_360', 'Kamera 360') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Asystent parkowania" id="w_park"><label class="form-check-label small text-white" for="w_park">{{ t.get('eq_park_assist', 'Asystent parkowania') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Head-Up Display" id="w_hud"><label class="form-check-label small text-white" for="w_hud">{{ t.get('eq_hud', 'Head-Up Display') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Ładowarka indukcyjna" id="w_wire"><label class="form-check-label small text-white" for="w_wire">{{ t.get('eq_wireless', 'Ładowarka indukcyjna') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Nagłośnienie Premium" id="w_sound"><label class="form-check-label small text-white" for="w_sound">{{ t.get('eq_sound', 'Nagłośnienie Premium') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Android Auto / CarPlay" id="w20"><label class="form-check-label small text-white" for="w20">{{ t.get('eq_android', 'Android Auto / CarPlay') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Tempomat aktywny" id="w14"><label class="form-check-label small text-white" for="w14">{{ t.get('eq_cruise_adapt', 'Tempomat aktywny (ACC)') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Keyless" id="w15"><label class="form-check-label small text-white" for="w15">{{ t.get('eq_keyless', 'Keyless') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Asystent pasa ruchu" id="w5"><label class="form-check-label small text-white" for="w5">{{ t.get('eq_lane', 'Asystent pasa ruchu') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Czujnik martwego pola" id="w6"><label class="form-check-label small text-white" for="w6">{{ t.get('eq_blind', 'Czujnik martwego pola') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Rozpoznawanie znaków" id="w_signs"><label class="form-check-label small text-white" for="w_signs">{{ t.get('eq_signs', 'Rozpoznawanie znaków') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Front Assist" id="w_front"><label class="form-check-label small text-white" for="w_front">{{ t.get('eq_front_assist', 'Front Assist') }}</label></div></div>
                                                <div class="col-6 col-md-4"><div class="form-check"><input class="form-check-input bg-dark border-secondary" type="checkbox" name="wyposazenie" value="Night Vision" id="w_night"><label class="form-check-label small text-white" for="w_night">{{ t.get('eq_night_vision', 'Night Vision') }}</label></div></div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        <div class="mt-3"><button type="button" class="btn btn-outline-success w-100 btn-sm rounded-pill py-2" onclick="getGPS(this)"><i class="bi bi-geo-alt-fill"></i> GPS</button></div>
                    </div>
                    <div class="modal-footer border-secondary pt-0 border-0"><button class="btn-submit-fix">{{ t.get('add', 'DODAJ OGŁOSZENIE') }}</button></div>
                </form>

            </div>
        </div>
    </div>

    <div class="modal fade" id="ustawieniaModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content shadow-lg rounded-4 border border-secondary">
                <div class="modal-header border-secondary">
                    <h5 class="fw-bold text-white"><i class="bi bi-person-gear me-2 text-danger"></i>Ustawienia Konta</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form action="/ustawienia_profilu" method="POST">
                    <div class="modal-body p-4">
                        
                        <div class="mb-3">
                            <label class="small text-muted fw-bold mb-2">Typ Konta</label>
                            <input type="hidden" name="account_type" id="val_profile_account" value="{{ current_user.account_type or 'private' }}">
                            <div class="dropdown">
                                <button class="btn custom-dropdown-btn dropdown-toggle w-100" type="button" data-bs-toggle="dropdown" id="btn_profile_account">
                                    {% if current_user.account_type == 'company' %}{{ t.get('company', 'Firma / Handlarz') }}{% else %}{{ t.get('private_person', 'Osoba Prywatna') }}{% endif %}
                                </button>
                                <ul class="dropdown-menu dropdown-menu-dark w-100 shadow-lg">
                                    <li><a class="dropdown-item" href="#" onclick="setProfileAccountType('private', `{{ t.get('private_person', 'Osoba Prywatna') }}`); return false;">{{ t.get('private_person', 'Osoba Prywatna') }}</a></li>
                                    <li><a class="dropdown-item" href="#" onclick="setProfileAccountType('company', `{{ t.get('company', 'Firma / Handlarz') }}`); return false;">{{ t.get('company', 'Firma / Handlarz') }}</a></li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="row g-2 mb-3">
                            <div class="col-5">
                                <label class="small text-muted fw-bold">Kraj</label>
                                <input type="hidden" name="kraj" id="val_profile_kraj" value="{{ current_user.kraj or 'Polska' }}">
                                <div class="dropdown h-100">
                                    <button class="btn custom-dropdown-btn dropdown-toggle w-100 h-100" type="button" data-bs-toggle="dropdown" id="btn_profile_kraj">
                                        {% if current_user.kraj == 'Niemcy' %}🇩🇪 Niemcy{% elif current_user.kraj == 'Belgia' %}🇧🇪 Belgia{% elif current_user.kraj == 'Holandia' %}🇳🇱 Holandia{% elif current_user.kraj == 'Francja' %}🇫🇷 Francja{% elif current_user.kraj == 'Inny' %}🌍 Inny{% else %}🇵🇱 Polska{% endif %}
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-dark w-100 shadow-lg">
                                        <li><a class="dropdown-item" href="#" onclick="setProfileDropdown('profile_kraj', 'Polska', '🇵🇱 Polska'); return false;">🇵🇱 Polska</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setProfileDropdown('profile_kraj', 'Niemcy', '🇩🇪 Niemcy'); return false;">🇩🇪 Niemcy</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setProfileDropdown('profile_kraj', 'Belgia', '🇧🇪 Belgia'); return false;">🇧🇪 Belgia</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setProfileDropdown('profile_kraj', 'Holandia', '🇳🇱 Holandia'); return false;">🇳🇱 Holandia</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setProfileDropdown('profile_kraj', 'Francja', '🇫🇷 Francja'); return false;">🇫🇷 Francja</a></li>
                                        <li><a class="dropdown-item" href="#" onclick="setProfileDropdown('profile_kraj', 'Inny', '🌍 Inny'); return false;">🌍 Inny</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="col-7">
                                <label class="small text-muted fw-bold">Miejscowość (np. Radom)</label>
                                <input type="text" name="lokalizacja" class="form-control" value="{{ current_user.lokalizacja }}">
                            </div>
                        </div>

                        <div id="sekcja_firma" style="display: {% if current_user.account_type == 'company' %}block{% else %}none{% endif %};">
                            <hr class="border-secondary my-4">
                            <h6 class="text-warning fw-bold small mb-3"><i class="bi bi-shop me-1"></i> DANE FIRMY</h6>
                            
                            <div class="mb-3">
                                <label class="small text-muted fw-bold">Nazwa Firmy</label>
                                <input type="text" name="company_name" class="form-control" value="{{ current_user.company_name or '' }}">
                            </div>
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <label class="small text-muted fw-bold">NIP</label>
                                    <input type="text" name="nip" class="form-control" value="{{ current_user.nip or '' }}">
                                </div>
                                <div class="col-6">
                                    <label class="small text-muted fw-bold">Adres (Ulica, Nr)</label>
                                    <input type="text" name="adres" class="form-control" placeholder="np. Warszawska 10" value="{{ current_user.adres or '' }}">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="small text-muted fw-bold">Wizytówka (Krótki opis działalności)</label>
                                <textarea name="opis_firmy" class="form-control" rows="3" placeholder="np. Import aut z Niemiec. Działamy od 10 lat...">{{ current_user.opis_firmy or '' }}</textarea>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer border-secondary pt-0 border-0">
                        <button type="submit" class="btn btn-danger w-100 fw-bold rounded-pill">ZAPISZ ZMIANY</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="cookie-banner" style="position: fixed; bottom: 85px; left: 10px; right: 10px; background: rgba(26,26,26,0.95); border: 1px solid #ce2b37; padding: 15px; text-align: center; z-index: 9999; display: none; box-shadow: 0 5px 20px rgba(0,0,0,0.8); border-radius: 15px; backdrop-filter: blur(10px);">
        <div class="container d-flex flex-column flex-md-row justify-content-center align-items-center gap-3">
            <span class="text-light small">🍪 Używamy plików cookies do obsługi Twojej sesji.</span>
            <button onclick="acceptCookies()" class="btn btn-sm btn-danger fw-bold px-4 rounded-pill">Zgoda</button>
        </div>
    </div>

    <div id="loaderOverlay">
        <video autoplay muted loop playsinline id="loaderVideo">
            <source src="{{ url_for('static', filename='loading.mp4') }}" type="video/mp4">
            <img src="{{ url_for('static', filename='watermark.png') }}" class="spinning-logo">
        </video> 
        <div class="loading-text">TWORZENIE OGŁOSZENIA...</div>
    </div>

    <div id="aiToast"><i class="bi bi-stars me-2"></i> Wykryłem zdjęcia! AI analizuje...</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function adj() { 
            const v = document.querySelector('input[name="typ"]:checked').value; 
            const ukryj = (v === 'Inne'); 
            document.querySelectorAll('.tech').forEach(e => { e.style.display = ukryj ? 'none' : 'block'; }); 
        }
        
        function getGPS(btn) { 
            if(!navigator.geolocation) { alert('Brak GPS'); return; } 
            btn.innerHTML='...'; 
            navigator.geolocation.getCurrentPosition(pos => { 
                document.getElementById('gps_lat').value=pos.coords.latitude; 
                document.getElementById('gps_lon').value=pos.coords.longitude; 
                btn.className="btn btn-success w-100 btn-sm rounded-pill py-2"; 
                btn.innerHTML="<i class='bi bi-check-lg'></i> OK"; 
            }, err => { alert('Błąd GPS'); }); 
        }
        
        function loadingEfekt(form) { 
            document.getElementById('loaderOverlay').style.display = 'flex'; 
        }

        if (!localStorage.getItem('cookiesAccepted')) { document.getElementById('cookie-banner').style.display = 'block'; }
        
        function acceptCookies() { 
            localStorage.setItem('cookiesAccepted', 'true'); 
            document.getElementById('cookie-banner').style.display = 'none'; 
        }
        
        function setVal(name, val, label) {
            document.getElementById('val_' + name).value = val;
            if(label) document.getElementById('btn_' + name).innerText = label;
            else document.getElementById('btn_' + name).innerText = val;
        }

        function setProfileDropdown(name, val, label) {
            document.getElementById('val_' + name).value = val;
            document.getElementById('btn_' + name).innerText = label;
        }

        function setProfileAccountType(val, label) {
            document.getElementById('val_profile_account').value = val;
            document.getElementById('btn_profile_account').innerText = label;
            document.getElementById('sekcja_firma').style.display = val === 'company' ? 'block' : 'none';
        }

        async function performAnalysis(file) {
            const toast = document.getElementById('aiToast'); toast.style.display = 'block';
            const fd=new FormData(); fd.append('scan_image', file); 
            try { 
                const r=await fetch('/api/analyze-car', {method:'POST', body:fd}); const d=await r.json(); 
                if(d.marka){ 
                    if(d.kategoria){ let r=document.querySelector(`input[name="typ"][value="${d.kategoria}"]`); if(r){ r.checked=true; adj(); }} 
                    document.querySelector('[name="marka"]').value=d.marka; 
                    document.querySelector('[name="model"]').value=d.model;
                    if(d.vin) document.querySelector('[name="vin"]').value=d.vin; 
                    document.querySelector('[name="rok"]').value=d.rok_sugestia||''; 
                    document.querySelector('[name="opis"]').value=d.opis_wizualny;
                    if(d.moc_sugestia) document.querySelector('[name="moc"]').value=d.moc_sugestia;
                    if(d.kolor) document.querySelector('[name="kolor"]').value=d.kolor;
                    if (d.wyposazenie_wykryte) {
                        d.wyposazenie_wykryte.forEach(item => {
                            let chk = document.querySelector(`input[name="wyposazenie"][value="${item}"]`);
                            if (chk) chk.checked = true;
                        });
                    }
                    if(d.paliwo_sugestia && d.kategoria!=='Inne'){
                        let t_label = d.paliwo_sugestia;
                        if(d.paliwo_sugestia === 'Benzyna') t_label = "{{ t.get('petrol', 'Benzyna') }}";
                        else if(d.paliwo_sugestia === 'Diesel') t_label = "{{ t.get('diesel', 'Diesel') }}";
                        else if(d.paliwo_sugestia === 'Hybryda') t_label = "{{ t.get('hybrid', 'Hybryda') }}";
                        else if(d.paliwo_sugestia === 'Elektryczny') t_label = "{{ t.get('electric', 'Elektryczny') }}";
                        else if(d.paliwo_sugestia === 'LPG') t_label = "{{ t.get('lpg', 'LPG') }}";
                        setVal('paliwo', d.paliwo_sugestia, t_label);
                    } 
                    toast.innerHTML = '<i class="bi bi-check-circle-fill me-2"></i> Dane uzupełnione!'; setTimeout(() => { toast.style.display = 'none'; }, 3000);
                } else { toast.style.display = 'none'; } 
            } catch(e){ console.error(e); toast.style.display = 'none'; } 
        }

        async function scanCar(input){ 
            if(!input.files[0]) return; 
            const mainInput = document.getElementById('fileInput'); const dt = new DataTransfer(); dt.items.add(input.files[0]); mainInput.files = dt.files;
            const headerLabel = document.getElementById('photoLabel'); headerLabel.innerHTML = '{{ t.get("photos", "ZDJĘCIA") }} <span class="text-success ms-2">✅ SKAN DODANY!</span>';
            performAnalysis(input.files[0]);
        }

                        // BARDZO BEZPIECZNY SKRYPT OBSŁUGI NOWYCH ZDJĘĆ
        const galleryInput = document.getElementById('mainGalleryInput');
        if (galleryInput) {
            galleryInput.addEventListener('change', function(e) {
                const headerLabel = document.getElementById('photoLabel'); 
                if(headerLabel && headerLabel.innerText.includes("SKAN")) { 
                    headerLabel.innerHTML = '{{ t.get("photos", "ZDJĘCIA") }}'; 
                }
                
                // Limit 18 zdjęć
                if (this.files.length > 18) { 
                    alert('⚠️ MAX 18 zdjęć.'); 
                    const dt = new DataTransfer(); 
                    for (let i = 0; i < 18; i++) { dt.items.add(this.files[i]); } 
                    this.files = dt.files; 
                }
                
                // WIZUALNA ZMIANA TEKSTU NA ZIELONY
                const countText = document.getElementById('fileCountText');
                if(countText) {
                    if(this.files.length > 0) {
                        countText.innerHTML = '<span class="text-success"><i class="bi bi-check-circle-fill me-1"></i> ' + this.files.length + ' ' + '{{ t.get("files_ready", "gotowych zdjęć") }}' + '</span>';
                        countText.parentElement.style.borderColor = '#198754';
                    } else {
                        countText.innerHTML = "{{ t.get('select_multiple', 'Zaznacz kilka zdjęć na raz') }}";
                        countText.parentElement.style.borderColor = 'rgba(255,255,255,0.2)';
                    }
                }

                // Automatyczne odpalenie AI, jeśli funkcja istnieje
                const markaField = document.querySelector('[name="marka"]'); 
                if (this.files.length > 0 && markaField && markaField.value.trim() === "") { 
                    if (typeof performAnalysis === "function") {
                        performAnalysis(this.files[0]); 
                    }
                }
            });
        }

        // BARDZO BEZPIECZNY SKRYPT OBSŁUGI NOWYCH ZDJĘĆ
        // ... (Twój obecny kod galerii zostaje bez zmian) ...

        // --- DODAJ TO ---
        function openEditUserModal(userId) {
            // Najpierw ukryj główną tabelę usersModal
            const usersModalEl = document.getElementById('usersModal');
            const usersModal = bootstrap.Modal.getInstance(usersModalEl) || new bootstrap.Modal(usersModalEl);
            usersModal.hide();

            // Poczekaj chwilę, aż animacja znikania (fade) się skończy, i dopiero wtedy pokaż ołówek
            setTimeout(() => {
                const editModalEl = document.getElementById('editUserModal' + userId);
                if(editModalEl) {
                    const editModal = new bootstrap.Modal(editModalEl);
                    editModal.show();
                }
            }, 500); // 500ms to bezpieczny margines na opadnięcie tła
        }

    </script>

        {% if current_user.username == 'admin' or current_user.id == 1 %}
    <div class="modal fade" id="usersModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border border-secondary text-white">
                <div class="modal-header border-secondary">
                    <h5 class="fw-bold"><i class="bi bi-people-fill me-2 text-danger"></i> Baza Użytkowników</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark table-hover mb-0 text-center align-middle">
                            <thead>
                                <tr class="text-secondary small text-uppercase">
                                    <th>ID</th>
                                    <th>Login</th>
                                    <th>Typ Konta</th>
                                    <th>Email</th>
                                    <th>Akcja</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if all_users is defined %}
                                    {% for u in all_users %}
                                    <tr>
                                        <td>{{ u.id }}</td>
                                        <td class="fw-bold text-white">
                                            <img src="{{ u.avatar_url or url_for('static', filename='watermark.png') }}" width="25" height="25" class="rounded-circle me-2" style="object-fit:cover;">
                                            {{ u.username }}
                                        </td>
                                        <td class="small">
                                            {% if u.account_type == 'company' %}
                                                <span class="badge bg-warning text-dark"><i class="bi bi-shop"></i> {{ u.company_name }}</span>
                                            {% else %}
                                                <span class="badge bg-secondary"><i class="bi bi-person"></i> Prywatne</span>
                                            {% endif %}
                                        </td>
                                        <td class="small text-muted">{{ u.email }}</td>
                                                                                <td>
                                            {% if u.id != current_user.id %}
                                            <div class="d-flex justify-content-center gap-2">
                                                <button type="button" class="btn btn-sm btn-outline-warning border-0" onclick="openEditUserModal('{{ u.id }}')" title="Edytuj dane firmy/adres">
    <i class="bi bi-pencil-square"></i>
</button>

                                                
                                                <form action="/admin/usun_user/{{ u.id }}" method="POST" onsubmit="return confirm('Czy na pewno chcesz usunąć tego użytkownika?');">
                                                    <button class="btn btn-sm btn-outline-danger border-0"><i class="bi bi-trash-fill"></i></button>
                                                </form>
                                            </div>
                                            {% else %}
                                                <span class="badge bg-warning text-dark">TY</span>
                                            {% endif %}
                                        </td>

                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr><td colspan="5" class="text-muted py-4">Brak zdefiniowanej zmiennej 'all_users' w backendzie.</td></tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% if all_users is defined %}
        {% for u in all_users %}
            {% if u.id != current_user.id %}
            <div class="modal fade text-start" id="editUserModal{{ u.id }}" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-white border-secondary shadow-lg">
                  <div class="modal-header border-secondary">
                    <h5 class="modal-title text-warning fw-bold"><i class="bi bi-pencil-square"></i> Edycja: {{ u.username }}</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Zamknij"></button>
                  </div>
                  
                  <form action="/admin/edytuj_user/{{ u.id }}" method="POST">
                      <div class="modal-body p-4">
                          <div class="row g-3">
                              <div class="col-md-6">
                                  <label class="small text-muted mb-1">Kraj</label>
                                  <input type="text" name="kraj" class="form-control bg-black text-white border-secondary" value="{{ u.kraj or '' }}" placeholder="np. Niemcy">
                              </div>
                              <div class="col-md-6">
                                  <label class="small text-muted mb-1">Miejscowość</label>
                                  <input type="text" name="lokalizacja" class="form-control bg-black text-white border-secondary" value="{{ u.lokalizacja or '' }}">
                              </div>
                              <div class="col-12">
                                  <label class="small text-muted mb-1">Dokładny adres</label>
                                  <input type="text" name="adres" class="form-control bg-black text-white border-secondary" value="{{ u.adres or '' }}">
                              </div>
                          </div>
                          
                          <hr class="border-secondary my-4">
                          
                          <div class="row g-3">
                              <div class="col-12">
                                  <label class="small text-muted mb-1">Nazwa Firmy / Komisu</label>
                                  <input type="text" name="company_name" class="form-control bg-black text-white border-secondary" value="{{ u.company_name or '' }}">
                              </div>
                              <div class="col-12">
                                  <label class="small text-muted mb-1">NIP</label>
                                  <input type="text" name="nip" class="form-control bg-black text-white border-secondary" value="{{ u.nip or '' }}">
                              </div>
                          </div>
                      </div>
                      
                      <div class="modal-footer border-secondary pt-0 border-0">
                        <button type="button" class="btn btn-outline-light rounded-pill px-4" data-bs-dismiss="modal">Anuluj</button>
                        <button type="submit" class="btn btn-warning text-dark fw-bold rounded-pill px-4 shadow">ZAPISZ ZMIANY</button>
                      </div>
                  </form>
                  
                </div>
              </div>
            </div>
            {% endif %}
        {% endfor %}
    {% endif %}

</body>
</html>
