<!DOCTYPE html>
<html lang="{{ lang }}" data-bs-theme="dark">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17939880807"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-17939880807');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tw√≥j Profil - Gie≈Çda Radom</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root { --radom-red: #ce2b37; --bg-dark: #121212; --card-dark: #1e1e1e; --text-grey: #b0b3b8; --premium-gold: #f0c420; }
        
        /* STYLE PREMIUM */
        .text-gold-glow { color: var(--premium-gold) !important; text-shadow: 0 0 15px rgba(240, 196, 32, 0.5); letter-spacing: 1px; }
        .btn-gold-premium {
            background: linear-gradient(135deg, #f0c420, #d4a017) !important;
            color: #000 !important; border: none !important; font-weight: 900 !important;
            box-shadow: 0 4px 15px rgba(240, 196, 32, 0.4) !important;
            transition: all 0.3s ease !important; position: relative; overflow: hidden;
        }
        .btn-gold-premium:hover {
            transform: translateY(-3px) scale(1.05) !important;
            box-shadow: 0 8px 25px rgba(240, 196, 32, 0.7) !important;
            background: linear-gradient(135deg, #ffd700, #e6b800) !important;
        }

        body { background-color: var(--bg-dark); color: #e4e6eb; font-family: 'Segoe UI', sans-serif; }
        .navbar { background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(10px); border-bottom: 2px solid var(--radom-red); }
        .car-card { background-color: var(--card-dark); border: 1px solid #333; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.3); transition: transform 0.2s; }
        .car-card:hover { transform: translateY(-5px); border-color: var(--radom-red); }
        .cat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .cat-item input { display: none; }
        .cat-label { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 70px; background: #2c2c2c; border: 1px solid #444; border-radius: 12px; cursor: pointer; font-size: 0.75rem; text-align: center; color: var(--text-grey); transition: 0.2s; }
        .cat-item input:checked + .cat-label { background: #3a1517; border-color: var(--radom-red); color: white; font-weight: bold; box-shadow: 0 0 10px rgba(206, 43, 55, 0.4); }
        .form-control, .form-select { background-color: #2c2c2c; border: 1px solid #444; color: white; padding: 10px; }
        .form-control:focus { background-color: #333; border-color: var(--radom-red); color: white; box-shadow: none; }

        /* SKANER AI */
        .scanner-box { border: 2px dashed var(--premium-gold); border-radius: 15px; padding: 20px; text-align: center; background: rgba(0,0,0,0.3); margin-bottom: 20px; }
        .btn-submit-fix { background-color: var(--radom-red); color: white; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; padding: 15px; width: 100%; border-radius: 12px; border: none; box-shadow: 0 5px 15px rgba(206, 43, 55, 0.4); margin-top: 20px; }
        .btn-submit-fix:hover { background-color: #b01b25; transform: scale(1.02); }
    </style>
</head>
<body>

<nav class="navbar navbar-dark p-3 mb-4 sticky-top">
    <div class="container d-flex justify-content-between">
        <a class="navbar-brand fw-bold" href="/"><i class="bi bi-speedometer2 text-danger"></i> Gie≈Çda Radom</a>
        <div class="d-flex gap-3 align-items-center text-white">
            <span class="d-none d-md-block small text-muted">{{ current_user.username }}</span>
            <a href="/logout" class="btn btn-outline-danger btn-sm rounded-pill px-3">{{ t['logout'] }}</a>
        </div>
    </div>
</nav>

<div class="container mb-5">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show mt-3 shadow-sm border-{{ category }}" role="alert">
                    <i class="bi bi-check-circle-fill me-2"></i> <strong>{{ message }}</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
        <div>
            <h2 class="fw-bold mb-0 text-white">{{ t['garage'] }}</h2>
            <div class="mt-1">
                {# Limit dla admina i zwyk≈Çych user√≥w #}
                {% if current_user.username == 'admin' or current_user.id == 1 %}
                    {% set limit = 500 %}
                {% else %}
                    {% set limit = 6 %}
                {% endif %}

                {% set uzyte = current_user.ai_requests_today %}
                {% set pozostalo = limit - uzyte %}
                {% if pozostalo < 0 %}{% set pozostalo = 0 %}{% endif %}

                <span class="badge {% if pozostalo == 0 %}bg-danger{% elif pozostalo < 3 %}bg-warning text-dark{% else %}bg-success{% endif %} border border-secondary shadow-sm" 
                      title="Limit odnawia siƒô codziennie">
                    <i class="bi bi-robot me-1"></i> LIMIT AI: {{ pozostalo }}/{{ limit }}
                </span>
            </div>
        </div>
        <button class="btn btn-danger rounded-pill px-4 py-2 shadow-lg fw-bold" data-bs-toggle="modal" data-bs-target="#dodajModal">
            <i class="bi bi-plus-lg me-1"></i> {{ t['add'] }}
        </button>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">
        {% for car in cars %}
        <div class="col">
            <div class="card car-card h-100">
                <div class="position-relative">
                    <img src="{{ car.img }}" class="card-img-top" style="height: 190px; object-fit: cover; opacity: 0.9;">
                    {% set dni = (now - car.data_dodania).days %}{% set left = 30 - dni %}
                    <span class="position-absolute top-0 end-0 m-2 badge {% if left < 3 %}bg-danger{% else %}bg-black{% endif %} bg-opacity-75 rounded-pill border border-secondary">
                        {% if left > 0 %}{{ left }} {{ t['days_left'] }}{% else %}{{ t['expired'] }}{% endif %}
                    </span>
                    {% if car.is_promoted %}<span class="position-absolute top-0 start-0 m-2 badge bg-warning text-dark border border-white shadow fw-bold">GOLD</span>{% endif %}
                </div>
                <div class="card-body d-flex flex-column">
                    <h5 class="fw-bold text-truncate text-white mb-1">{{ car.marka }} {{ car.model }}</h5>
                    <h4 class="text-danger fw-800">{{ "{:,.0f}".format(car.cena).replace(',', ' ') }} PLN</h4>
                    <div class="row g-2 small text-muted mb-3 mt-1">
                        <div class="col-6"><i class="bi bi-calendar3"></i> {{ car.rok }}r.</div>
                        <div class="col-6"><i class="bi bi-fuel-pump"></i> {{ car.paliwo }}</div>
                        <div class="col-6"><i class="bi bi-speedometer2"></i> {{ car.przebieg }}</div>
                        <div class="col-6"><i class="bi bi-eye"></i> {{ car.views }}</div>
                    </div>
                    <div class="mt-auto pt-3 border-top border-secondary d-grid gap-2">
                        <div class="d-flex gap-2">
                            <a href="/ogloszenie/{{ car.id }}" class="btn btn-outline-info btn-sm w-50 fw-bold"><i class="bi bi-eye"></i></a>
                            <a href="/edytuj/{{ car.id }}" class="btn btn-outline-light btn-sm w-50 fw-bold"><i class="bi bi-pencil"></i></a>
                        </div>
                        <div class="d-flex gap-2">
                            <form action="/odswiez/{{ car.id }}" method="POST" class="w-50"><button class="btn btn-success btn-sm w-100 fw-bold text-white"><i class="bi bi-arrow-clockwise"></i></button></form>
                            <form action="/usun/{{ car.id }}" method="POST" class="w-50" onsubmit="return confirm('?')"><button class="btn btn-dark btn-sm w-100 fw-bold border-secondary text-danger"><i class="bi bi-trash"></i></button></form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center text-muted py-5 border border-secondary rounded-4 bg-dark bg-opacity-25">
            <h4 class="text-white">...</h4>
        </div>
        {% endfor %}
    </div>

    {% if current_user.username == 'admin' or current_user.id == 1 %}
    <div class="card admin-box shadow-lg mb-5 border-0" style="background: linear-gradient(145deg, #1a1a1a, #000); border-left: 5px solid #ffc107;">
        <div class="card-header bg-transparent border-warning d-flex justify-content-between align-items-center pt-3 pb-2">
            <h5 class="text-warning mb-0 fw-bold" style="letter-spacing: 1px;"><i class="bi bi-shield-lock-fill me-2"></i> CENTRUM DOWODZENIA</h5>
            <span class="badge bg-warning text-dark shadow fw-bold">ROOT ADMIN</span>
        </div>
        <div class="card-body text-white">
            <div class="row g-3 mb-4 text-center">
                <div class="col-4">
                    <div class="p-3 rounded-3 border border-secondary bg-dark bg-opacity-50">
                        <h3 class="fw-bold text-white mb-0">{{ user_count }}</h3>
                        <small class="text-secondary text-uppercase fw-bold" style="font-size:0.65rem;">WSZYSTKIE KONTA</small>
                    </div>
                </div>
                <div class="col-4">
                    <div class="p-3 rounded-3 border border-success bg-success bg-opacity-10">
                        <h3 class="fw-bold text-success mb-0">{{ online_count }}</h3>
                        <small class="text-success text-uppercase fw-bold" style="font-size:0.65rem;">ONLINE TERAZ</small>
                    </div>
                </div>
                <div class="col-4">
                    <div class="p-3 rounded-3 border border-info bg-info bg-opacity-10">
                        <h3 class="fw-bold text-info mb-0">{{ total_views }}</h3>
                        <small class="text-info text-uppercase fw-bold" style="font-size:0.65rem;">WY≈öWIETLENIA</small>
                    </div>
                </div>
            </div>

            <div class="bg-black bg-opacity-25 p-3 rounded-3 border border-secondary">
                <div class="mt-3 mb-3">
                    <button class="btn btn-danger w-100 fw-bold shadow-sm" data-bs-toggle="modal" data-bs-target="#usersModal">
                        <i class="bi bi-people-fill me-2"></i> ZARZƒÑDZAJ U≈ªYTKOWNIKAMI ({{ all_users|length }})
                    </button>
                </div>

                <label class="small text-muted fw-bold mb-2 text-uppercase"><i class="bi bi-save me-1"></i> System Backup</label>
                <div class="d-flex gap-2">
                    <a href="{{ url_for('backup_db') }}" class="btn btn-outline-warning w-100 fw-bold btn-sm py-2">
                        <i class="bi bi-database-down me-1"></i> BAZA SQL
                    </a>
                    <a href="{{ url_for('full_backup') }}" class="btn btn-warning w-100 fw-bold btn-sm py-2 text-dark">
                        <i class="bi bi-archive-fill me-1"></i> PE≈ÅNY ZIP
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="text-center mt-5 mb-4 pt-4 border-top border-secondary">
        <p class="text-white-50 small mb-2">ZarzƒÖdzanie kontem</p>
        <form action="/usun_konto" method="POST" onsubmit="return confirm('‚ö†Ô∏è UWAGA!\n\nTo operacja nieodwracalna. Twoje konto oraz wszystkie Twoje og≈Çoszenia zostanƒÖ bezpowrotnie usuniƒôte.\n\nCzy na pewno chcesz kontynuowaƒá?');">
            <button class="btn btn-outline-danger btn-sm px-4 rounded-pill opacity-75">
                <i class="bi bi-trash3-fill me-2"></i> Usu≈Ñ moje konto trwale
            </button>
        </form>
    </div>
</div>

<div class="modal fade" id="dodajModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content shadow-lg rounded-4 bg-dark border border-secondary">
            <div class="modal-header border-secondary">
                <h5 class="fw-bold text-white">{{ t['add'] }}</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form action="/dodaj" method="POST" enctype="multipart/form-data" onsubmit="loadingEfekt(this)">
                <input type="hidden" name="lat" id="gps_lat">
                <input type="hidden" name="lon" id="gps_lon">

                <div class="modal-body p-4 pt-2">

                    <div class="cat-grid">
                        <div class="cat-item"><input type="radio" name="typ" id="c1" value="Osobowe" checked onchange="adj()"><label for="c1" class="cat-label"><i class="bi bi-car-front"></i>Osobowe</label></div>
                        <div class="cat-item"><input type="radio" name="typ" id="c2" value="SUV" onchange="adj()"><label for="c2" class="cat-label"><i class="bi bi-jeep"></i>SUV</label></div>
                        <div class="cat-item"><input type="radio" name="typ" id="c3" value="Ciezarowe" onchange="adj()"><label for="c3" class="cat-label"><i class="bi bi-truck"></i>Bus</label></div>
                        <div class="cat-item"><input type="radio" name="typ" id="c4" value="Skuter" onchange="adj()"><label for="c4" class="cat-label"><i class="bi bi-scooter"></i>Moto</label></div>
                        <div class="cat-item"><input type="radio" name="typ" id="c5" value="Rower" onchange="adj()"><label for="c5" class="cat-label"><i class="bi bi-bicycle"></i>Rower</label></div>
                        <div class="cat-item"><input type="radio" name="typ" id="c6" value="Inne" onchange="adj()"><label for="c6" class="cat-label"><i class="bi bi-grid"></i>Inne</label></div>
                    </div>

                    <div class="scanner-box">
                        <div class="mb-3 text-gold-glow fw-bold fs-5">
                            <i class="bi bi-stars"></i> GEMINI 3.0 EXPERT <i class="bi bi-stars"></i>
                        </div>

                        <div class="d-flex justify-content-center gap-3">
                            <label class="btn btn-gold-premium rounded-pill px-4 py-2 shadow-lg">
                                <i class="bi bi-camera-fill me-2 fs-5"></i> SKANUJ AUTO (AI)
                                <input type="file" name="scan_image_cam" accept="image/*" capture="environment" hidden onchange="scanCar(this)">
                            </label>

                            <label class="btn btn-outline-light rounded-pill px-3 py-2 fw-bold">
                                <i class="bi bi-folder-fill me-2"></i> Wgraj plik
                                <input type="file" name="scan_image_file" accept="image/*" hidden onchange="scanCar(this)">
                            </label>
                        </div>

                        <div id="scanLoader" class="mt-3 small text-warning fw-bold" style="display:none;">
                            <span class="spinner-border spinner-border-sm me-1"></span> Sztuczna Inteligencja analizuje pojazd...
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <label class="small fw-bold text-muted mb-1">ZDJƒòCIA</label>
                            <span class="small text-warning fw-bold" style="font-size: 0.7rem;">
                                <i class="bi bi-images me-1"></i> MAX 18 SZT.
                            </span>
                        </div>
                        <div class="input-group">
                            <input type="file" name="zdjecia" class="form-control" multiple accept="image/*" id="fileInput">
                            <label class="input-group-text bg-secondary text-white" for="fileInput">Wybierz</label>
                        </div>
                        <div class="form-text text-white-50 small mt-1">
                            * Pierwsze wybrane zdjƒôcie bƒôdzie ok≈ÇadkƒÖ og≈Çoszenia.
                        </div>
                    </div>

                    <div class="row g-2">
                        <div class="col-6"><label class="small fw-bold text-muted">Marka</label><input type="text" name="marka" class="form-control" placeholder="np. BMW"></div>
                        <div class="col-6"><label class="small fw-bold text-muted">Model</label><input type="text" name="model" class="form-control" placeholder="np. X5"></div>

                        <div class="col-12">
                            <label class="small fw-bold text-success">Numer VIN (Opcjonalne)</label>
                            <div class="input-group input-group-sm">
                                <span class="input-group-text bg-dark border-secondary text-white">
                                    <i class="bi bi-upc-scan"></i>
                                </span>
                                <input type="text" name="vin" class="form-control text-uppercase" placeholder="Wpisz numer nadwozia..." maxlength="17">
                            </div>
                        </div>

                        <div class="col-4"><label class="small fw-bold text-muted">Rok</label><input type="number" name="rok" class="form-control"></div>
                        <div class="col-4"><label class="small fw-bold text-muted">Cena (PLN)</label><input type="number" name="cena" class="form-control border-danger text-danger fw-bold" required></div>
                        <div class="col-4 tech"><label class="small fw-bold text-muted">Przebieg</label><input type="number" name="przebieg" class="form-control"></div>
                        <div class="col-6 tech"><label class="small fw-bold text-muted">Pojemno≈õƒá</label><input type="text" name="pojemnosc" class="form-control"></div>
                        <div class="col-6 tech"><label class="small fw-bold text-muted">Paliwo</label><select name="paliwo" class="form-select"><option>Benzyna</option><option>Diesel</option><option>LPG</option><option>Hybryda</option><option>Elektryczny</option></select></div>
                        <div class="col-6 tech"><label class="small fw-bold text-muted">Skrzynia</label><select name="skrzynia" class="form-select"><option>Manualna</option><option>Automatyczna</option></select></div>
                        <div class="col-12"><label class="small fw-bold text-muted">Telefon</label><input type="text" name="telefon" class="form-control" required></div>
                        <div class="col-12"><label class="small fw-bold text-muted">Opis</label><textarea name="opis" class="form-control" rows="3" placeholder="{{ t['desc_ai'] }}"></textarea></div>
                    </div>

                    <div class="mt-3">
                        <button type="button" class="btn btn-outline-success w-100 btn-sm rounded-pill py-2" onclick="getGPS(this)">
                            <i class="bi bi-geo-alt-fill"></i> GPS
                        </button>
                    </div>
                </div>
                <div class="modal-footer border-secondary pt-0 border-0">
                    <button class="btn-submit-fix">{{ t['add'] }}</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% if current_user.username == 'admin' or current_user.id == 1 %}
<div class="modal fade" id="usersModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content bg-dark border border-secondary text-white">
            <div class="modal-header border-secondary">
                <h5 class="fw-bold">Baza U≈ºytkownik√≥w</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <div class="table-responsive">
                    <table class="table table-dark table-hover mb-0 text-center align-middle">
                        <thead>
                            <tr class="text-secondary small text-uppercase">
                                <th>ID</th>
                                <th>Login</th>
                                <th>Email</th>
                                <th>Lokalizacja</th>
                                <th>Akcja</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for u in all_users %}
                            <tr>
                                <td>{{ u.id }}</td>
                                <td class="fw-bold text-white">{{ u.username }}</td>
                                <td class="small text-muted">{{ u.email }}</td>
                                <td class="small">{{ u.lokalizacja }}</td>
                                <td>
                                    {% if u.id != current_user.id %}
                                    <form action="/admin/usun_user/{{ u.id }}" method="POST" onsubmit="return confirm('Czy na pewno usunƒÖƒá u≈ºytkownika {{ u.username }} i jego og≈Çoszenia?');">
                                        <button class="btn btn-sm btn-outline-danger border-0">
                                            <i class="bi bi-trash-fill"></i>
                                        </button>
                                    </form>
                                    {% else %}
                                    <span class="badge bg-warning text-dark">TY</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div id="cookie-banner" style="position: fixed; bottom: 0; left: 0; right: 0; background: #1a1a1a; border-top: 2px solid #ce2b37; padding: 15px; text-align: center; z-index: 9999; display: none; box-shadow: 0 -5px 20px rgba(0,0,0,0.8);">
    <div class="container d-flex flex-column flex-md-row justify-content-center align-items-center gap-3">
        <span class="text-light small">
            üç™ <strong>Ta strona u≈ºywa plik√≥w cookies</strong> w celu analizy ruchu i obs≈Çugi logowania. 
            KorzystajƒÖc ze strony, zgadzasz siƒô na ich u≈ºycie.
        </span>
        <button onclick="acceptCookies()" class="btn btn-sm btn-danger fw-bold px-4 rounded-pill">
            ROZUMIEM I AKCEPTUJƒò
        </button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function adj(){ const v=document.querySelector('input[name="typ"]:checked').value; const h=(v==='Rower'||v==='Inne'); document.querySelectorAll('.tech').forEach(e=>e.style.display=h?'none':'block'); }
    function getGPS(btn){ if(!navigator.geolocation) { alert('Brak GPS'); return; } btn.innerHTML='...'; navigator.geolocation.getCurrentPosition(pos => { document.getElementById('gps_lat').value=pos.coords.latitude; document.getElementById('gps_lon').value=pos.coords.longitude; btn.className="btn btn-success w-100 btn-sm rounded-pill py-2"; btn.innerHTML="<i class='bi bi-check-lg'></i> OK"; }, err => { alert('B≈ÇƒÖd GPS'); }); }
    
    // EFEKT ≈ÅADOWANIA
    function loadingEfekt(form) {
        const btn = form.querySelector('.btn-submit-fix');
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> ZAPISUJƒò... CZEKAJ!';
        btn.style.opacity = '0.7';
        btn.style.pointerEvents = 'none';
    }

    // COOKIES
    if (!localStorage.getItem('cookiesAccepted')) {
        document.getElementById('cookie-banner').style.display = 'block';
    }
    function acceptCookies() {
        localStorage.setItem('cookiesAccepted', 'true');
        document.getElementById('cookie-banner').style.display = 'none';
    }

    // AI SKANER
    async function scanCar(input){ if(!input.files[0]) return; document.getElementById('scanLoader').style.display='block'; const fd=new FormData(); fd.append('scan_image', input.files[0]); try { const r=await fetch('/api/analyze-car', {method:'POST', body:fd}); const d=await r.json(); if(d.marka){ if(d.kategoria){ let r=document.querySelector(`input[name="typ"][value="${d.kategoria}"]`); if(r){ r.checked=true; adj(); }} document.querySelector('[name="marka"]').value=d.marka; document.querySelector('[name="model"]').value=d.model;
if(d.vin) document.querySelector('[name="vin"]').value=d.vin; document.querySelector('[name="rok"]').value=d.rok_sugestia||''; document.querySelector('[name="opis"]').value=d.opis_wizualny; if(d.paliwo_sugestia && d.kategoria!=='Inne' && d.kategoria!=='Rower'){ const sel=document.querySelector('[name="paliwo"]'); for(let i=0;i<sel.options.length;i++){ if(sel.options[i].text===d.paliwo_sugestia) sel.selectedIndex=i; } } alert('‚úÖ Gemini: '+d.marka); } else alert('‚ö†Ô∏è Nie rozpoznano'); } catch(e){ console.error(e); alert('‚ö†Ô∏è B≈ÇƒÖd'); } document.getElementById('scanLoader').style.display='none'; }

    // --- BLOKADA NA MAX 18 ZDJƒòƒÜ ---
    document.getElementById('fileInput').addEventListener('change', function(e) {
        if (this.files.length > 18) {
            alert('‚ö†Ô∏è Wybrano za du≈ºo zdjƒôƒá (' + this.files.length + '). System automatycznie pozostawi≈Ç tylko pierwsze 18 sztuk.');

            const dt = new DataTransfer();
            for (let i = 0; i < 18; i++) {
                dt.items.add(this.files[i]);
            }
            this.files = dt.files; // Podmieniamy listƒô na przyciƒôtƒÖ
        }
    });
</script>
</body>
</html>
